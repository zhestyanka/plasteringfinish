#!/bin/bash

# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Next.js –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å Next.js –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pm2 stop all
pm2 delete all

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
echo "üìÅ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞..."
cd /var/www/plasteringfinish

# 3. –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üßπ –û—á–∏—â–∞–µ–º –≤—Å–µ –∫—ç—à–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
rm -rf node_modules
rm -rf .next
rm -rf package-lock.json
rm -rf pnpm-lock.yaml

# 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Node.js –∏ npm
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º Node.js –∏ npm..."
node --version
npm --version

# 5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ..."
npm install --legacy-peer-deps --force

# 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Next.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º Next.js..."
ls -la node_modules/.bin/next

# 7. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
npm run build

# 8. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä–∫—É..."
ls -la .next

# 9. –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2..."
pm2 start ecosystem.config.js
pm2 save

# 10. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å PM2..."
pm2 status

# 11. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏
echo "üìã –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏..."
pm2 logs plasteringfinish --lines 10

# 12. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ—Ä—Ç 3000 —Å–ª—É—à–∞–µ—Ç—Å—è
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 3000..."
netstat -tlnp | grep :3000

echo ""
echo "üéâ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo ""
echo "üåê –°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
echo "http://45.153.188.66:3000"
echo ""
echo "üì± –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:"
echo "http://45.153.188.66:3000/admin"
echo "–õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: admin123"
echo ""
echo "üìã –ï—Å–ª–∏ —Å–∞–π—Ç –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "1. pm2 status"
echo "2. pm2 logs plasteringfinish"
echo "3. netstat -tlnp | grep :3000"
