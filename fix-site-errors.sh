#!/bin/bash

# üîß –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ —Å–∞–π—Ç–∞
echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ —Å–∞–π—Ç–∞..."

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
pm2 stop plasteringfinish

# 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git –¥–ª—è merge
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git..."
git config pull.rebase false

# 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git add .
git commit -m "Fix site errors: Telegram integration and React versions"

# 4. –¢—è–Ω–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å merge
echo "‚¨áÔ∏è –¢—è–Ω–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å merge..."
git pull origin main --no-rebase

# 5. –£–¥–∞–ª—è–µ–º node_modules –∏ package-lock.json
echo "üóëÔ∏è –û—á–∏—â–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
rm -rf node_modules package-lock.json

# 6. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install --legacy-peer-deps --force

# 7. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
npm run build

# 8. –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
pm2 start ecosystem.config.js
pm2 save

# 9. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
pm2 status

# 10. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏..."
pm2 logs plasteringfinish --lines 20

echo ""
echo "üéâ –û—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
echo ""
echo "üîß –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:"
echo "‚úÖ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:"
echo "   - –£–±—Ä–∞–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
echo "   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫"
echo "   - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞"
echo ""
echo "‚úÖ –í–µ—Ä—Å–∏–∏ React:"
echo "   - –ü–æ–Ω–∏–∂–µ–Ω—ã —Å React 19 –¥–æ React 18.3.1"
echo "   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏"
echo "   - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
echo ""
echo "‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:"
echo "   - Telegram —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –ª–æ–º–∞—é—Ç —Å–∞–π—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"
echo "   - Graceful fallback –¥–ª—è –≤—Å–µ—Ö Telegram –æ–ø–µ—Ä–∞—Ü–∏–π"
echo ""
echo "üåê –°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
echo "http://45.153.188.66:3000"
echo ""
echo "üì± –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:"
echo "http://45.153.188.66:3000/admin"
echo "–õ–æ–≥–∏–Ω: admin, –ü–∞—Ä–æ–ª—å: admin123"
echo ""
echo "ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞):"
echo "http://45.153.188.66:3000/admin/telegram"
